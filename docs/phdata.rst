Photon-HDF5 format definition
=============================

Overview
--------

An overview of the data format is shown in the following figure:

.. figure:: /images/alex-photon-hdf5.png
    :align: center

A Photon-HDF5 is a standard HDF5 file with a predefined structure.

Every Photon-HDF5 file has a **/photon_data** group that
contains the photon timestamps and other per-photon data.
In the most basic form **/photon_data** contains only the per-photon data
(timestamps, detectors, nanotimes, etc...). However, in order to correctly
interpret the data, additional information is needed (for example
which detector is donor/acceptor in a 2-colors smFRET experiment, or the
alternation period in a us-ALEX experiment). These additional specifications,
if present, are contained inside **/photon_data** in the
**measurement_specs** sub-group.

Other optional groups are:

- **/indentity**: information about the data file
- **/provenance**: information about the original data file
- **/setup**: fundamental parameters of the experimental setup
- **/sample**: sample information.

The following sections describe in details all the Photon-HDF5
groups and fields.

Root-level parameters
---------------------

- **/acquisition_time**: (float) the measurement duration in seconds.
- **/comment**: (string) a user defined comment.


Photon-data group
-----------------


This section illustrates the layout of the **/photon_data** group:

Mandatory:

- **timestamps**
- **timestamps_specs/**
    - **timestamps_unit**

Optional if there is only 1 detector:

- **detectors**

In addition, when the dataset contains nanotime information, the following
fields must be present:

- **nanotimes**
- **nanotimes_specs/**
    - **tcspc_unit**
    - **tcspc_range**
    - **tcspc_num_bins**

Measurement specs
^^^^^^^^^^^^^^^^^

The optional **/photon_data/measurements_specs** group contains additional
information that allows to correctly interpret the data for each specific
type of measurement.

This group is optional, but if present it must be complete.

- **measurement_type**: (string) "smFRET", "smFRET-usALEX", etc...

For us-ALEX, 2, 3 or N colors

- **alex_period**

For ns-ALEX (or lifetime with no alternation)

- **laser_pulse_rate**

For 2-color (or more) us-ALEX and ns-ALEX (optional)

- **alex_period_spectral_ch1**
- **alex_period_spectral_ch2**
- etc...

Detectors specs
"""""""""""""""

An important sub-group of ``measurement_specs`` is **detectors_specs/**
that contains the mapping between the each pixel ID and the detection channels
(i.e. spectral bands, polarizations, etc...).


- **labels**: (optional) a table with 2 columns: detector ID and detector
  label (string).
  For 2-color smFRET the labels should be "donor" and "acceptor".
  When detector ID is a n-tuple, labels has n+1 column (n for the ID
  and 1 for the labels).

For all 2-color detection (or more) measurements:

- **spectral_ch1**
- **spectral_ch2**
- etc...

For measurements that record polarization:

- **polarization_ch1**
- **polarization_ch2**

When the detection path is split in 2 ch. through a non-polarizing beam splitter

- **split_ch1**
- **split_ch2**


setup group
-----------

The **/setup** group contains information about the measurement setup:

- **num_pixels**
- **num_spots**                integer or 'none'
- **num_spectral_ch**
- **num_polariz_ch**
- **num_split_ch**

- **modulated_excitation** True if there is any form of excitation modulation (wavelength,
  polarization). True also for 2 or more pulse-interleaved excitation
  (PIE) or ns-ALEX.
- **lifetime**

- **excitation_cw** list of booleans indicating, for each excitation wavelengths,
  whether the excitation is CW.

- **excitation_wavelengths** list of excitation wavelengths

Optional if not relevant

- **detection_wavelengths** list of reference wavelengths for each detection spectral band

- **excitation_polarizations** list of angles for each *excitation wavelength*
- **detection_polarizations** list of angles for each *detection channel*

- **excitation_powers**

- **detection_splits_ratios** list of power fractions detected by each "split" channel
  (i.e. detection channels generated by beam splitting
  through a non-polarizing beam splitter)


identity group
--------------

The **identity/** group contains info about the specific Photon-HDF5 file:

- **filename**: (string)
- **full_filename**: (string)
- **creation_time**: (string) Creation time as "YYYY-MM-DD HH:MM:SS".
- **software**: (string)
- **software_version**: (string)
- **format_name**: (string) This must always be "Photon-HDF5"
- **format_version**: (string) "0.3"
- **format_url**: (string) A URL pointing to the Photon-HDF5 documentation.

provenance group
----------------

The **provenance/** group contains info about the original file that has
been converted to Photon-HDF5 file. This group is optionla but reccomended.

- **author**: (string)
- **affiliation**: (string)
- **filename**: (string)
- **full_filename**: (string)
- **creation_time**: (string)
- **modification_time**: (string)
- **software**: (string)
- **software_version**: (string)

sample group
------------

The **/sample** group contains information related to the measured sample.
This group is optional.

- **num_dyes**: (integer) number of different dyes present in the samples.
- **dye_names**: (array of string) list of dye names (for example: ['ATTO550', 'ATTO647N'])
- **buffer_name**: (string) a user defined description for the buffer.
- **sample_name**: (string) a user defined description for the sample.
